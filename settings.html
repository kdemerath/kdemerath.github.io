<!DOCTYPE HTML>
<html>
	<head>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
	</head>
	<body>
		<h1>Habitica-Tasks Options</h1>
		<p>User authentication</p>
		<label for="userId">User ID:
			<input id="userId">
		</label>
		<label for="apiToken">API Token:
			<input id="apiToken">
		</label>
    <br><br>
		<button type="submit" data-theme="a" id="b-submit">Submit</button>
	</body>
	
	<script>
		// Get query variables
		function getQueryParam(variable, defaultValue) {
			// Find all URL parameters
			var query = location.search.substring(1);
			var vars = query.split('&');
			for (var i = 0; i < vars.length; i++) {
				var pair = vars[i].split('=');
				
				// If the query variable parameter is found, decode it to use and return it for use
				if (pair[0] === variable) {
					return decodeURIComponent(pair[1]);
				}
			}
			return defaultValue || false;
		}
		
		function saveOptions() {
			var userId = document.getElementById("userId");
			var apiToken = document.getElementById("apiToken");
 
    			var options = {
				'userId': userId.value,
				'apiToken': apiToken.value
			}
			return options;
		};
		
		var submitButton = document.getElementById("b-submit");
		submitButton.addEventListener("click",
			function() {	
				var options = saveOptions();
				// Set the return URL depending on the runtime environment
				var return_to = getQueryParam('return_to', 'pebblejs://close#');
				location.href = return_to + encodeURIComponent(JSON.stringify(options));
				//location.href = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
				<!--//document.location = location;-->
			},
			false);
	</script>
</html>
