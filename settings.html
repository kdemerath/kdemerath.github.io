<!DOCTYPE HTML>
<html>
	<head>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	</head>
	<body>
		<h1>Habitica-Tasks Options</h1>
		<p>v1.10(2)</p>
		<p>User authentication</p>
		<label for="userId">User ID:
			<input id="userId">
		</label>
		<br>
		<label for="apiToken">API Token:
			<input id="apiToken">
		</label>
    		<br><br>
		<button type="submit" data-theme="a" id="b-submit">Submit</button>
	</body>
	
	<script>
		function updateSettings() {
			if (window.location.search) {
				var settings = decodeURIComponent(window.location.search).replace('?settings=','');
				if (settings == "null") {
					settings = '{"banner":"Hello World","weekday":"y","showdate":true,"footer":"03"}';
				}
				if (settings) {
					var json = $.parseJSON(settings);
					if (json.userId) {
						$('#userId').val(json.userId);
					}
					if (json.apiToken) {
						$('#apiToken').val(json.apiToken);
					}
					if (json.apiToken) {
						$('#apiToken').val(json.weekday).slider('refresh');
					}
					if (json.footer) {
						$('#footer').val(json.footer).selectmenu('refresh');
					}
					$("#showdate").prop('checked',json.showdate).checkboxradio('refresh');
	      			}
	    		}
	  	}
		
		
		function saveOptions() {
			var userId = document.getElementById("userId");
			var apiToken = document.getElementById("apiToken");
 
    			var options = {
				'userId': userId.value,
				'apiToken': apiToken.value
			}
			return options;
		};
		
		var submitButton = document.getElementById("b-submit");
		submitButton.addEventListener("click",
			function() {	
				var options = saveOptions();
				// Set the return URL depending on the runtime environment
				var return_to = getQueryParam('return_to', 'pebblejs://close#');
				location.href = return_to + encodeURIComponent(JSON.stringify(options));
				//location.href = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
				<!--//document.location = location;-->
			},
			false);
			
		$('#main').bind('pageinit', updateSettings);
			
	</script>
</html>
